{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/agentic-checkout/bundle.schema.json",
  "title": "Agentic Checkout \u2014 Schema Bundle",
  "$defs": {
    "Address": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string"
        },
        "line_one": {
          "type": "string"
        },
        "line_two": {
          "type": "string"
        },
        "city": {
          "type": "string"
        },
        "state": {
          "type": "string"
        },
        "country": {
          "type": "string"
        },
        "postal_code": {
          "type": "string"
        }
      },
      "required": [
        "name",
        "line_one",
        "city",
        "state",
        "country",
        "postal_code"
      ]
    },
    "Buyer": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "first_name": {
          "type": "string"
        },
        "last_name": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone_number": {
          "type": "string"
        }
      },
      "required": ["first_name", "last_name", "email"]
    },
    "Item": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "quantity": {
          "type": "integer",
          "minimum": 1
        }
      },
      "required": ["id", "quantity"]
    },
    "PaymentProvider": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["stripe"]
        },
        "supported_payment_methods": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["card"]
          }
        }
      },
      "required": ["provider", "supported_payment_methods"]
    },
    "LineItem": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "item": {
          "$ref": "#/$defs/Item"
        },
        "base_amount": {
          "type": "integer"
        },
        "discount": {
          "type": "integer"
        },
        "subtotal": {
          "type": "integer"
        },
        "tax": {
          "type": "integer"
        },
        "total": {
          "type": "integer"
        }
      },
      "required": [
        "id",
        "item",
        "base_amount",
        "discount",
        "subtotal",
        "tax",
        "total"
      ]
    },
    "Total": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "items_base_amount",
            "items_discount",
            "subtotal",
            "discount",
            "fulfillment",
            "tax",
            "fee",
            "total"
          ]
        },
        "display_text": {
          "type": "string"
        },
        "amount": {
          "type": "integer"
        }
      },
      "required": ["type", "display_text", "amount"]
    },
    "FulfillmentOptionShipping": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "shipping"
        },
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "subtitle": {
          "type": "string"
        },
        "carrier": {
          "type": "string"
        },
        "earliest_delivery_time": {
          "type": "string",
          "format": "date-time"
        },
        "latest_delivery_time": {
          "type": "string",
          "format": "date-time"
        },
        "subtotal": {
          "type": "integer"
        },
        "tax": {
          "type": "integer"
        },
        "total": {
          "type": "integer"
        }
      },
      "required": ["type", "id", "title", "subtotal", "tax", "total"]
    },
    "FulfillmentOptionDigital": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "digital"
        },
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "subtitle": {
          "type": "string"
        },
        "subtotal": {
          "type": "integer"
        },
        "tax": {
          "type": "integer"
        },
        "total": {
          "type": "integer"
        }
      },
      "required": ["type", "id", "title", "subtotal", "tax", "total"]
    },
    "MessageInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "info"
        },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath"
        },
        "content_type": {
          "type": "string",
          "enum": ["plain", "markdown"]
        },
        "content": {
          "type": "string"
        }
      },
      "required": ["type", "content_type", "content"]
    },
    "MessageError": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "const": "error"
        },
        "code": {
          "type": "string",
          "enum": [
            "missing",
            "invalid",
            "out_of_stock",
            "payment_declined",
            "requires_sign_in",
            "requires_3ds"
          ]
        },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath"
        },
        "content_type": {
          "type": "string",
          "enum": ["plain", "markdown"]
        },
        "content": {
          "type": "string"
        }
      },
      "required": ["type", "code", "content_type", "content"]
    },
    "Link": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["terms_of_use", "privacy_policy", "seller_shop_policies"]
        },
        "url": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": ["type", "url"]
    },
    "PaymentData": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "token": {
          "type": "string"
        },
        "provider": {
          "type": "string",
          "enum": ["stripe"]
        },
        "billing_address": {
          "$ref": "#/$defs/Address"
        }
      },
      "required": ["token", "provider"]
    },
    "Order": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "checkout_session_id": {
          "type": "string"
        },
        "permalink_url": {
          "type": "string",
          "format": "uri"
        }
      },
      "required": ["id", "checkout_session_id", "permalink_url"]
    },
    "Refund": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["store_credit", "original_payment"]
        },
        "amount": {
          "type": "integer"
        }
      },
      "required": ["type", "amount"]
    },
    "CheckoutSessionBase": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string"
        },
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "payment_provider": {
          "$ref": "#/$defs/PaymentProvider"
        },
        "status": {
          "type": "string",
          "enum": [
            "not_ready_for_payment",
            "ready_for_payment",
            "completed",
            "canceled",
            "in_progress"
          ]
        },
        "currency": {
          "type": "string"
        },
        "line_items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/LineItem"
          }
        },
        "fulfillment_address": {
          "$ref": "#/$defs/Address"
        },
        "fulfillment_options": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/FulfillmentOptionShipping"
              },
              {
                "$ref": "#/$defs/FulfillmentOptionDigital"
              }
            ]
          }
        },
        "fulfillment_option_id": {
          "type": "string"
        },
        "totals": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Total"
          }
        },
        "messages": {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "$ref": "#/$defs/MessageInfo"
              },
              {
                "$ref": "#/$defs/MessageError"
              }
            ]
          }
        },
        "links": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Link"
          }
        }
      },
      "required": [
        "id",
        "status",
        "currency",
        "line_items",
        "totals",
        "fulfillment_options",
        "messages",
        "links"
      ]
    },
    "CheckoutSession": {
      "allOf": [
        {
          "$ref": "#/$defs/CheckoutSessionBase"
        }
      ]
    },
    "CheckoutSessionWithOrder": {
      "allOf": [
        {
          "$ref": "#/$defs/CheckoutSessionBase"
        },
        {
          "type": "object",
          "properties": {
            "order": {
              "$ref": "#/$defs/Order"
            }
          },
          "required": ["order"]
        }
      ]
    },
    "CheckoutSessionCreateRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Item"
          },
          "minItems": 1
        },
        "fulfillment_address": {
          "$ref": "#/$defs/Address"
        }
      },
      "required": ["items"]
    },
    "CheckoutSessionUpdateRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Item"
          }
        },
        "fulfillment_address": {
          "$ref": "#/$defs/Address"
        },
        "fulfillment_option_id": {
          "type": "string"
        }
      }
    },
    "CheckoutSessionCompleteRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "buyer": {
          "$ref": "#/$defs/Buyer"
        },
        "payment_data": {
          "$ref": "#/$defs/PaymentData"
        }
      },
      "required": ["payment_data"]
    },
    "Error": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "invalid_request",
            "request_not_idempotent",
            "processing_error",
            "service_unavailable"
          ]
        },
        "code": {
          "type": "string",
          "description": "Implementation-defined error code"
        },
        "message": {
          "type": "string"
        },
        "param": {
          "type": "string",
          "description": "RFC 9535 JSONPath (optional)"
        }
      },
      "required": ["type", "code", "message"]
    }
  }
}
